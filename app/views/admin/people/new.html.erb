<% content_for :navbar do %>
  <%= render "pages/admin_navbar" %>
<% end %>
<%= link_to admin_people_path, class: "back_link" do %>
  <i class="material-icons">arrow_back_ios</i>
  <span>Annuler et revenir à l'index</span>
<% end %>
<h1>Créer une nouvelle fiche personne</h1>
<%= simple_form_for [:admin, @person] do |f| %>
  <div class="form-half">
    <div class="left">
      <%= f.input :gender, 
                  label: false, 
                  as: :radio_buttons, 
                  collection: [['0', 'Femme'], ['1', 'Homme']], 
                  label_method: :second, 
                  value_method: :first,
                  checked: ['0', 'Femme'],
                  required: true %>
    </div>
    <div class="right">
      <%= f.input :profile_pic, 
                  label: "Photo de profil", 
                  as: :file %>
    </div>
  </div>
  <div class="form-half">
    <div class="left">
      <%= f.input :first_name, 
                  label: "Prénom", 
                  as: :string,
                  input_html: { autocomplete: 'off' },
                  placeholder: "ex : Ivan" %>
    </div>
    <div class="right">
      <%= f.input :last_name, 
                  label: "Nom de famille", 
                  as: :string,
                  placeholder: "ex : GORKI",
                  input_html: { autocomplete: 'off' },
                  required: true %>
    </div>
  </div>
  <div class="form-half">
    <div class="left">
      <%= f.input :middle_name, 
                  label: "Autres prénoms",
                  input_html: { autocomplete: 'off' },
                  as: :string %>
    </div>
    <div class="right">
      <%= f.input :spouse_name, 
                  label: "Nom d'épouse", 
                  input_html: { autocomplete: 'off' },
                  as: :string %>
    </div>
  </div>
  <hr>
  <div class="alias-form hidden">
    <%= f.simple_fields_for :aliases do |a| %>
      <div class="form-half">
        <div class="left">
          <%= a.input :category,
                      label: "Type",
                      as: :string,
                      placeholder: "ex : Nom de guerre" %>
        </div>
        <div class="right">
          <%= a.input :name,
                      label: "Alias",
                      as: :string,
                      placeholder: "ex : Dassault" %>
        </div>
      </div>
    <% end %>
  </div>
  <div class="flex flex-row">
    <button class="btn btn-red remove-alias block hidden mr10">Enlever le dernier alias</button>
    <button class="btn add-alias block">Ajouter un alias</button>
  </div>
  <hr>
  <div class="form-half">
    <div class="left">
      <%= f.input :birth_date, 
                  input_html: { autocomplete: 'off' },
                  label: "Date de naissance", 
                  as: :date_picker %>
    </div>
    <div class="right">
      <%= f.input :birth_place, 
                  label: "Lieu de naissance", 
                  as: :string %>
    </div>
  </div>
  <div class="form-half">
    <div class="left">
      <%= f.input :death_date,
                  input_html: { autocomplete: 'off' },
                  label: "Date de décès", 
                  as: :date_picker %>
    </div>
    <div class="right">
      <%= f.input :death_place, 
                  label: "Lieu de décès", 
                  as: :string %>
    </div>
  </div>
  <hr>
  <%= f.input :biography, 
              label: "Biographie", 
              as: :text,
              placeholder: "Renseigner ici la biographie de cette personne. Par exemple les différents évènements qui ont marqué sa vie, ses engagements etc." %>
  <hr>
  <%= f.input :notes, 
              label: "Carnet de notes", 
              as: :text,
              placeholder: "Renseigner ici les commentaires historiographiques qui concernent cette personne. Par exemple comment ses informations ont été obtenues, quelle institution détient certains documents." %>
  <%= button_tag type: "submit", class: "btn" do %>
    <i class="material-icons">person_add</i> Créer la fiche
  <% end %>
<% end %>

<script>
  // DatePicker
  $("input.date_picker").datepicker({ dateFormat: 'yy-mm-dd', changeYear: true, yearRange: '1800:2030' });

  // Add Alias
  var alias_attributes = ["category", "name"];
  var k = $('.alias-form').length;

  $('.add-alias').click(function(event){
    event.preventDefault();
    var aliases = $('.alias-form').length;
    var lastAlias = $('.alias-form').last();
    var removeButton = $('.remove-alias').last();
    removeButton.removeClass('hidden');

    if (aliases == 1 && lastAlias.hasClass('hidden')) {
      lastAlias.removeClass('hidden');
    } else {
      var newAlias = lastAlias.clone();
      newAlias.find('input').each(function(j) {
        $(this).attr('name', 'person[aliases]['+k+']['+ alias_attributes[j] +']');
        $(this).removeAttr('id');
      });
      lastAlias.after(newAlias);
    }
    k++;
  });

  // Remove Alias
  $('.remove-alias').click(function(event){
    event.preventDefault();

    var removeButton = $('.remove-alias').last();
    var aliases = $('.alias-form').length;
    var lastAlias = $('.alias-form').last();

    if (aliases == 1) {
      removeButton.addClass('hidden');
      lastAlias.val('');
      lastAlias.addClass('hidden');
    } else {
      lastAlias.remove();
    }
  });
</script>